#!/bin/bash

set -euo pipefail

echo "--- Build RPM spec: ${BUILDKITE_PLUGIN_RPMBUILD_SPEC}"

sed "s/%name%/${BUILDKITE_PLUGIN_RPMBUILD_NAME}/g" ${BUILDKITE_PLUGIN_RPMBUILD_SPEC} > "${BUILDKITE_PLUGIN_RPMBUILD_NAME}.spec"

rpmbuild -ba "${BUILDKITE_PLUGIN_RPMBUILD_NAME}.spec" --define "_rpmdir ${BUILDKITE_PLUGIN_RPMBUILD_SHARE}"

