steps:
  - label: ":cloud: Phoenix Get Properties"
    key: "get_properties"
    plugins:
      - ./plugins/phx_get_props:
          packageId: 1337
          share: "${TMP}"

  - label: ":milky_way: Dynamic build RPMS"
    command: ./dynamic/build_rpms.sh rpm1 rpm2 rpm3 | buildkite-agent pipeline upload
    depends_on: "get_properties"
    plugins:
      - docker#v3.5.0:
          image: "ubuntu:latest"
          environment: 
            - "HTTP_PROXY=http://proxy-chain.intel.com:911"
            - "HTTPS_PROXY=http://proxy-chain.intel.com:911"
    
  - wait

  - label: ":yum: Generate meta data"
    commands: 
      - "mkdir meta"
      - "echo {\"meta-data\": \"hello\"} meta/meta.json"
    plugins:
      - docker#v3.5.0:
          image: "ubuntu:latest"
          environment: 
            - "HTTP_PROXY=http://proxy-chain.intel.com:911"
            - "HTTPS_PROXY=http://proxy-chain.intel.com:911"
